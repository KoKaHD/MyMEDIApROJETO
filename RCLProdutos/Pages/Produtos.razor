@page "/produtos"
@page "/categoria/{Id:int}"

@inject ApiService Api
@inject NavigationManager Nav

<header class="page-head">
    <h3 class="page-title">@((Id is null) ? "Produtos" : "Produtos por Categoria")</h3>
</header>

<CategoriasFriso SelectedId="@(Id ?? 0)" OnSelected="GoCategoria" />

@if (produtos == null)
{
    <p>A carregar produtos...</p>
}
else if (produtos.Count == 0)
{
    <p>Sem produtos para mostrar.</p>
}
else
{
    <div class="grid-produtos">
        @foreach (var p in produtos)
        {
            <ProdutoCard Produto="p" OnClick="GoDetalhe" />
        }
    </div>
}

@code {
    [Parameter] public int? Id { get; set; }
    private List<ProdutoDTO>? produtos;

    protected override async Task OnParametersSetAsync()
    {
        produtos = Id == null
            ? await Api.GetProdutosAsync()
            : await Api.GetProdutosPorCategoriaAsync(Id.Value);
    }

    private Task GoDetalhe(ProdutoDTO p)
    {
        Nav.NavigateTo($"/produto/{p.Id}");
        return Task.CompletedTask;
    }

    private Task GoCategoria(int catId)
    {
        Nav.NavigateTo($"/categoria/{catId}");
        return Task.CompletedTask;
    }
}